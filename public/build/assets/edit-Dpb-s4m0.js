import{r as d,j as a}from"./app-B-1fJ2-S.js";import H from"./NewForm-BOVwxqpn.js";import{z as A}from"./index-Li1fpA5v.js";import"./Topic-BBUEKn4r.js";import"./Question-hgkQOrTp.js";const W=d.forwardRef(({projectSelected:p,onCloseConfirmed:m},S)=>{const v=d.useRef({tabs:[],title:""}),[E,C]=d.useState([{id:null,tab_title:"Tab 1",title:"",description:"",video:"",color:"",image:null,image_path:null,topics:[]}]),[w,u]=d.useState(!0),[n,g]=d.useState([{id:null,tab_title:"Tab 1",title:"",description:"",video:"",color:"",image:null,image_path:null,topics:[]}]),[$,R]=d.useState([]),[h,f]=d.useState(0),[T,j]=d.useState("");d.useImperativeHandle(S,()=>({handleClose:X}));const[k,F]=d.useState([]),[O,I]=d.useState([]),[z,J]=d.useState([]),K=()=>{g([...n,{id:null,tab_title:"Tab "+(n.length+1),title:"",description:"",video:"",color:"",image:null,topics:[]}]),f(n.length)};d.useEffect(()=>{p&&q(p)},[p]),d.useEffect(()=>{console.log(n)},[n]);const M=()=>!w&&E!==n,X=()=>{M()&&window.confirm("You have unsaved changes. Save before closing?")?N():m()},q=async t=>{var s;u(!0);try{const e=await axios.get(`/projects/${t}`,{headers:{"Content-Type":"multipart/form-data"}});e.data.projects.length!=0&&(g(e.data.projects),C(e.data.projects)),v.current={tabs:JSON.stringify(e.data.projects),title:e.data.title},j(e.data.title),u(!1)}catch(e){console.error("Error:",((s=e.response)==null?void 0:s.data)||e),u(!1)}},L=(t,s)=>{if(n.length===1)return;const e=n.filter((i,r)=>r!==t);R(i=>[...i,s]),g(e),f(Math.max(0,t-1))},N=async t=>{var s;t.preventDefault();try{const e=new FormData;n.forEach((r,l)=>{const o=`tabs[${l}]`;e.append(`${o}[title]`,r.title),e.append(`${o}[id]`,r.id),e.append(`${o}[tab_title]`,r.tab_title),e.append(`${o}[color]`,r.color),e.append(`${o}[group_contents_id]`,p),e.append(`${o}[description]`,r.description),e.append(`${o}[video]`,r.video||""),r.image&&e.append(`${o}[image]`,r.image),e.append(`${o}[removed_topics]`,JSON.stringify(k)),e.append(`${o}[removed_questions]`,JSON.stringify(O)),e.append(`${o}[removed_answers]`,JSON.stringify(z)),Array.isArray(r.topics)&&_(e,r.topics,`${o}[topics]`)}),console.log("=== FORM DATA CONTENTS ===");for(const[r,l]of e.entries())console.log(r,l instanceof File?`File: ${l.name}`:l);const i=await axios.post("/projects",e,{headers:{"Content-Type":"multipart/form-data"}});$.length>0&&await axios.delete("/projects",{data:{ids:$},headers:{"Content-Type":"application/json"}}),v.current={tabs:JSON.stringify(n),title:T},A.success("✅ All tabs saved successfully!"),m()}catch(e){console.error("Error details:",((s=e.response)==null?void 0:s.data)||e),A.error("❌ Failed to save some tabs!")}},_=(t,s,e="topics")=>{s.forEach((i,r)=>{const l=`${e}[${r}]`;t.append(`${l}[id]`,i.id??""),t.append(`${l}[title]`,i.title??""),t.append(`${l}[description]`,i.description??""),t.append(`${l}[color]`,i.color??""),t.append(`${l}[video]`,i.video??""),i.image instanceof File?t.append(`${l}[image]`,i.image):typeof i.image_path=="string"&&t.append(`${l}[image_path]`,i.image_path),Array.isArray(i.questions)&&i.questions.forEach((o,P)=>{const x=`${l}[questions][${P}]`;t.append(`${x}[id]`,o.id??""),t.append(`${x}[title]`,o.title??""),Array.isArray(o.answers)&&o.answers.forEach((b,Q)=>{const y=`${x}[answers][${Q}]`;t.append(`${y}[id]`,b.id??""),t.append(`${y}[text]`,b.text??""),t.append(`${y}[is_correct]`,b.is_correct?1:0)})}),Array.isArray(i.topics)&&i.topics.length>0&&_(t,i.topics,`${l}[topics]`)})},c=(t,s,e)=>{const i=[...n];i[t][s]=e,g(i)};return w?a.jsx("div",{className:"bg-white dark:bg-gray-900   h-full  mx-auto rounded-lg p-5",children:a.jsx("div",{className:"block w-full  mt-20 my-auto  bg-white dark:bg-gray-900 shadow z-10 p-5",children:a.jsxs("div",{className:"bg-white h-full flex flex-col dark:bg-gray-900 rounded-lg p-5",children:[a.jsx("img",{src:"/anjo-mascott.png",alt:"Mascot",className:"w-52 md:w-64 animate-bounce  mx-auto drop-shadow-lg",style:{filter:"drop-shadow(0 0 12px rgba(124, 255, 255, 0.3))"}}),a.jsxs("div",{className:"mt-8 text-center",children:[a.jsx("div",{className:"text-lg font-semibold  mx-auto tracking-wide uppercase animate-pulse",children:"Loading magic ✨"}),a.jsx("div",{className:"w-48 h-1 mt-3  mx-auto bg-purple-300 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-white animate-slide-x"})})]}),a.jsx("style",{children:`
            @keyframes slide-x {
              0% { transform: translateX(-100%); }
              50% { transform: translateX(0%); }
              100% { transform: translateX(100%); }
            }
            .animate-slide-x {
              animation: slide-x 4s ease-in-out infinite;
            }
      
            @keyframes fade-in {
              from { opacity: 0; transform: scale(0.95); }
              to { opacity: 1; transform: scale(1); }
            }
            .animate-fade-in {
              animation: fade-in 1.2s ease-out forwards;
            }
          `})]})})}):a.jsxs("div",{className:"bg-white dark:bg-gray-900 shadow rounded-lg",onClick:t=>t.stopPropagation(),children:[a.jsx("div",{className:"sticky -top-1 dark:bg-gray-900 bg-gray-100 px-6 z-10",children:a.jsxs("div",{className:"w-full flex flex-col items-center",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-gray-900 dark:text-gray-300 mt-4 block text-left",children:"Main Title"}),a.jsx("input",{type:"text",className:"text-2xl font-semibold text-gray-800 dark:text-gray-800 p-2 mb-4 block mx-auto text-center",value:T,onChange:t=>j(t.target.value)})]}),a.jsxs("div",{className:"flex space-x-2 bg-white dark:bg-gray-700 rounded-full px-4 py-2 mb-6 shadow-md",children:[n.map((t,s)=>a.jsxs("div",{onClick:()=>f(s),style:{backgroundColor:t.color},className:`px-4 py-2 rounded-full cursor-pointer border  ${h===s?"bg-indigo-600 text-white dark:border-white border-[#000000] border-2 font-bold":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:[t.tab_title||`Tab ${s+1}`,n.length>1&&a.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),L(s,t.id)},className:"ml-2 text-sm text-red-400 hover:text-red-600",children:"✕"})]},t.id)),a.jsx("button",{type:"button",onClick:K,className:"px-3 py-2 bg-green-500 text-white rounded-full hover:bg-green-600",children:"+ Add Tab"})]})]})}),n.map((t,s)=>a.jsx("div",{className:"bg-white dark:bg-gray-900 max-w-2xl mx-auto rounded-lg p-5",children:a.jsx("div",{className:`${h===s?"block":"hidden"} w-full bg-white dark:bg-gray-900 shadow z-10 p-5`,style:{backgroundColor:n[h].color},children:a.jsx("div",{className:"bg-white dark:bg-gray-900 max-w-2xl mx-auto rounded-lg p-5",children:a.jsx(H,{handleSaveAll:N,projectSelected:p,tabTitle:t.tab_title,color:t.color,setColor:e=>c(s,"color",e),setTabTitle:e=>c(s,"tab_title",e),title:t.title,setTitle:e=>c(s,"title",e),description:t.description,setDescription:e=>c(s,"description",e),video:t.video,setVideo:e=>c(s,"video",e),image_path:t.image_path,image:t.image,setImage:e=>c(s,"image",e),topics:t.topics,setTopics:e=>c(s,"topics",e),setRemovedTopics:F,removedTopics:k,setRemovedAnswers:J,setRemovedQuestions:I})},t.id)},s)},t.id))]})});export{W as default};
